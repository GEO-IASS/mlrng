---
title: "Benchmarking Example"
output:
  pdf_document
urlcolor: blue
linkcolor: blue
vignette: >
  %\VignetteIndexEntry{Benchmarking}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---
```{r, include=FALSE}
library(mlrng)
```

## Create Tasks

### Task `iris`

A classification task using the famous iris data set is predefined in the package:
```{r}
as.data.table(Tasks)
iris.task = Tasks$get("iris")
```
Some simple task getters:
```{r}
iris.task$target
iris.task$features
iris.task$formula
```
The data is stored in an abstract class `DataBackend`.
It is designed to transparently access in-memory data structures like `data.frame` or `data.table` as well as real DBMS via the `dplyr` package.
Because most data bases can only be accessed read-only, the operations on these backends are limited.
You can query some basic information and subset rows and columns though:
```{r}
iris.task$backend$nrow
iris.task$backend$ncol
iris.task$backend$active.rows
iris.task$backend$active.cols
iris.task$backend$active.cols = setdiff(iris.task$backend$active.cols, "Petal.Length")
iris.task$backend$subsample(ratio = 0.9)
iris.task$backend$get()
```

## Create Learners

All learners are stored in a register called `Learners` and can easily be listed:
```{r}
as.data.table(Learners)
```

### Dummy classification learner

You can retrieve learners from the dictionary `Learners`:
```{r}
lrn.dummy = Learners$get("classif.dummy")
```

The parameter set is stored in the slot `par.set` and parameters deviating from the default are stored in `par.vals`:
```{r}
lrn.dummy$par.set
lrn.dummy$par.vals
```

Now, we set the parameter `method` to `"sample"`, change the `id` and add the learner to the register:
```{r}
lrn.dummy$par.vals = list(method = "sample")
lrn.dummy$id = "classif.dummy.sample"
Learners$add(lrn.dummy)
as.data.table(Learners)
```
From now on, we can just pass the id `"classif.dummy.sample"` to other functions to use this learner.

### CART

```{r}
lrn.rpart = Learners$get("classif.rpart")
```

## Measures

```{r}
as.data.table(Measures)
measure = Measures$get("mmce")
```

## Resampling

```{r}
as.data.table(Resamplings)
r = Resamplings$get("cv")
print(r)

# change to 3-fold cv
r$iters = 3
```

## Resample

```{r}
rr = resample(task = iris.task, learner = lrn.dummy, resampling = r, measures = list(measure))
rr$aggr
as.data.table(rr)
```

## Benchmark

```{r}
tasks = lapply(c("iris", "breastcancer"), Tasks$get)
learners = lapply(c("classif.dummy", "classif.rpart"), Learners$get)
resamplings = lapply("cv", Resamplings$get)
measures = lapply("mmce", Measures$get)

bmr = benchmark(
  tasks = tasks,
  learners = learners,
  resamplings = resamplings,
  measures = measures)
bmr
head(as.data.table(bmr))
```
